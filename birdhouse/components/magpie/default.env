# All env in this default.env can be overridden by env.local.

# All env in this default.env must NOT depend on any other env.  If they do, they
# must use single quotes to avoid early expansion before overrides in env.local
# are applied and must be added to the list of DELAYED_EVAL.

# Tag version that will be used to update Magpie API, Magpie CLI, and matching Twitcher with Magpie Adapter
export MAGPIE_VERSION=5.0.0
export MAGPIE_IMAGE='pavics/magpie:${MAGPIE_VERSION}'
export MAGPIE_IMAGE_URI='registry.hub.docker.com/${MAGPIE_IMAGE}'

export MAGPIE_DB_NAME="magpiedb"

export MAGPIE_PERSIST_DIR='${BIRDHOUSE_DATA_PERSIST_ROOT}/magpie_persist'

# Magpie user registration and approvals
export MAGPIE_USER_REGISTRATION_ENABLED=false
export MAGPIE_USER_REGISTRATION_APPROVAL_ENABLED=false
export MAGPIE_USER_REGISTRATION_NOTIFY_ENABLED=false

# Logging level for Magpie/Twitcher
#   DEBUG:  logs detailed information about operations/settings (not for production, will leak sensitive data)
#   INFO:   reports useful information, not leaking details about settings
#   WARN:   only potential problems/unexpected results reported, such as when caching is employed
export MAGPIE_LOG_LEVEL=INFO

# Location of config directories for magpie permissions, providers, and webhooks.
# Note that these are path *inside* the magpie container (not on host)
export MAGPIE_PROVIDERS_CONFIG_PATH="/opt/local/src/magpie/config/providers"
export MAGPIE_PERMISSIONS_CONFIG_PATH="/opt/local/src/magpie/config/permissions"
export MAGPIE_WEBHOOKS_CONFIG_PATH="/opt/local/src/magpie/config/webhooks"

# Network mode settings. See for details: 
# https://pavics-magpie.readthedocs.io/en/latest/configuration.html#network-mode-settings
export MAGPIE_NETWORK_PEM_DIR='${BIRDHOUSE_DATA_PERSIST_ROOT}/magpie_pem'
export MAGPIE_NETWORK_ENABLED=false  # Note: by default network mode is off (false)
export MAGPIE_NETWORK_INSTANCE_NAME=  # Note: this must be a unique name in the network so no default is set
export MAGPIE_NETWORK_DEFAULT_TOKEN_EXPIRY=86400
export MAGPIE_NETWORK_INTERNAL_TOKEN_EXPIRY=30
export MAGPIE_NETWORK_TOKEN_NAME=magpie_token
export MAGPIE_NETWORK_PROVIDER=magpie_network
export MAGPIE_NETWORK_NAME_PREFIX=magpie_network_
export MAGPIE_NETWORK_GROUP_NAME=magpie_network
export MAGPIE_NETWORK_PEM_FILES=key.pem  # These files must be relative paths from the MAGPIE_NETWORK_PEM_DIR directory
export MAGPIE_NETWORK_PEM_PASSWORDS=
export MAGPIE_NETWORK_CREATE_MISSING_PEM_FILE=true

# translate MAGPIE_NETWORK_PEM_FILES to the location of the files on the magpie container
export MAGPIE_NETWORK_PEM_FILES_ON_CONTAINER='$(echo "/magpie-pem/${MAGPIE_NETWORK_PEM_FILES#:}" | sed "s|:|:/magpie-pem/|g" )'

export DELAYED_EVAL="
  $DELAYED_EVAL
  MAGPIE_PERSIST_DIR
  MAGPIE_IMAGE
  MAGPIE_IMAGE_URI
  MAGPIE_NETWORK_PEM_DIR
  MAGPIE_NETWORK_PEM_FILES_ON_CONTAINER
"

# add any new variables not already in 'VARS' or 'OPTIONAL_VARS' that must be replaced in templates here
VARS="
  $VARS
  \$MAGPIE_SECRET
  \$MAGPIE_ADMIN_USERNAME
  \$MAGPIE_ADMIN_PASSWORD
  \$MAGPIE_PROVIDERS_CONFIG_PATH
  \$MAGPIE_PERMISSIONS_CONFIG_PATH
  \$MAGPIE_WEBHOOKS_CONFIG_PATH
  \$POSTGRES_MAGPIE_USERNAME
  \$POSTGRES_MAGPIE_PASSWORD
"

OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$MAGPIE_GITHUB_CLIENT_ID
  \$MAGPIE_GITHUB_CLIENT_SECRET
  \$MAGPIE_DB_NAME
  \$MAGPIE_USER_REGISTRATION_ENABLED
  \$MAGPIE_USER_REGISTRATION_SUBMISSION_EMAIL_TEMPLATE
  \$MAGPIE_USER_REGISTRATION_APPROVAL_ENABLED
  \$MAGPIE_USER_REGISTRATION_APPROVAL_EMAIL_RECIPIENT
  \$MAGPIE_USER_REGISTRATION_APPROVAL_EMAIL_TEMPLATE
  \$MAGPIE_USER_REGISTRATION_APPROVED_EMAIL_TEMPLATE
  \$MAGPIE_USER_REGISTRATION_DECLINED_EMAIL_TEMPLATE
  \$MAGPIE_USER_REGISTRATION_NOTIFY_ENABLED
  \$MAGPIE_USER_REGISTRATION_NOTIFY_EMAIL_RECIPIENT
  \$MAGPIE_USER_REGISTRATION_NOTIFY_EMAIL_TEMPLATE
  \$MAGPIE_GROUP_TERMS_SUBMISSION_EMAIL_TEMPLATE
  \$MAGPIE_GROUP_TERMS_APPROVED_EMAIL_TEMPLATE
  \$MAGPIE_SMTP_FROM
  \$MAGPIE_SMTP_HOST
  \$MAGPIE_SMTP_PORT
  \$MAGPIE_SMTP_SSL
  \$MAGPIE_SMTP_PASSWORD
  \$MAGPIE_LOG_LEVEL
  \$MAGPIE_VERSION
  \$MAGPIE_IMAGE
  \$MAGPIE_IMAGE_URI
  \$MAGPIE_NETWORK_ENABLED
  \$MAGPIE_NETWORK_INSTANCE_NAME
  \$MAGPIE_NETWORK_DEFAULT_TOKEN_EXPIRY
  \$MAGPIE_NETWORK_INTERNAL_TOKEN_EXPIRY
  \$MAGPIE_NETWORK_TOKEN_NAME
  \$MAGPIE_NETWORK_PROVIDER
  \$MAGPIE_NETWORK_NAME_PREFIX
  \$MAGPIE_NETWORK_GROUP_NAME
  \$MAGPIE_NETWORK_PEM_FILES_ON_CONTAINER
  \$MAGPIE_NETWORK_PEM_PASSWORDS
  \$MAGPIE_NETWORK_CREATE_MISSING_PEM_FILE
"
