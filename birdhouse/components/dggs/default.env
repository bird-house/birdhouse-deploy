# --------------------------------------------------------------
# DGGS: Discrete Global Grid System API
# --------------------------------------------------------------

# All env in this default.env can be overridden by env.local.

# All env in this default.env must NOT depend on any other env.  If they do, they
# must use single quotes to avoid early expansion before overrides in env.local
# are applied and must be added to the list of DELAYED_EVAL.

export DGGS_VERSION=0.2.0-rc
export DGGS_DOCKER=crim-ca/pydggsapi
export DGGS_IMAGE='${DGGS_DOCKER}:${DGGS_VERSION}'
export DGGS_IMAGE_URI='registry.hub.docker.com/${DGGS_IMAGE}'

# can be used to load local data into the container and cross-referencing in the PyDGGS-API configuration
# otherwise, 'optional-components/secure-data-proxy' can be used to provide access to data via the Web
export DGGS_DATA_DIR='${BIRDHOUSE_DATA_PERSIST_ROOT}/dggs'

# path of the configuration file known to PyDGGS-API
# by default, uses the file generated from the sample template to provide one example allowing API startup
# if other DGGRS/DGGS data sources are desired, it can be overridden entirely
export DGGS_CONFIG_PATH=./components/dggs/config/dggs/pydggsapi-config.json

# API runtime configuration
export DGGS_WORKERS=8
export DGGS_LOG_LEVEL=info

### --- danger zone --- ###
# Following variables are used to more easily map various API components across configurations.
# While their values can be overridden, diverging from the defaults will most probably break behavior.
# It is NOT recommended to change them unless you know what you are doing.

# root URI where the API will be accessible from
# it shoud start with a '/' and have no trailing '/' for rules to be applied properly
# it can include any amount of path segments (e.g. '/dggs-api/v1')
# however, only the first part will be used as Magpie service name
# nested paths would have to define explicit Magpie resources to resolve access control mapping
export DGGS_API_NAME=dggs-api
export DGGS_API_PATH='/${DGGS_API_NAME}'
# internal path used by the actual API application from proxy redirection
# this variable wiil allow 'DGGS_API_PATH' to be mapped directly to the API root
export DGGS_API_PATH_INTERNAL=/dggs-api/dggs-api
# same as above, but for the additional tiles capabilities provided by the service
export DGGS_TILES_NAME=tiles-api
export DGGS_TILES_PATH='/${DGGS_TILES_NAME}'
export DGGS_TILES_PATH_INTERNAL=/tiles-api
# same as above, but for the API documentation
export DGGS_DOCS_PATH_INTERNAL=/docs
### ------------------- ###

# add any new variables not already in 'VARS' or 'OPTIONAL_VARS' that must be replaced in templates here
# single quotes are important in below list to keep variable names intact until 'birdhouse-compose' parses them
EXTRA_VARS='
  $DGGS_VERSION
  $DGGS_IMAGE
  $DGGS_DATA_DIR
  $DGGS_CONFIG_PATH
  $DGGS_API_NAME
  $DGGS_API_PATH
  $DGGS_API_PATH_INTERNAL
  $DGGS_TILES_NAME
  $DGGS_TILES_PATH
  $DGGS_TILES_PATH_INTERNAL
  $DGGS_DOCS_PATH_INTERNAL
'
# extend the original 'VARS' from 'birdhouse/birdhouse-compose.sh' to employ them for template substitution
# adding them to 'VARS', they will also be validated in case of override of 'default.env' using 'env.local'
VARS="$VARS $EXTRA_VARS"

OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$DGGS_DOCKER
  \$DGGS_IMAGE_URI
  \$DGGS_LOG_LEVEL
  \$DGGS_WORKERS
  \$SECURE_DATA_PROXY_AUTH_INCLUDE
"

export DELAYED_EVAL="
  $DELAYED_EVAL
  DGGS_IMAGE
  DGGS_IMAGE_URI
  DGGS_DATA_DIR
  DGGS_API_PATH
  DGGS_TILES_PATH
"

COMPONENT_DEPENDENCIES="
  $COMPONENT_DEPENDENCIES
  ./components/magpie
  ./components/twitcher
"
