# NOTE:
#   See also the following components that can be used in conjunction with this component to further
#   customize data access mechanisms of the STAC API.
#
#   - birdhouse/components/stac
#   - birdhouse/optional-components/stac-data-proxy
#   - birdhouse/optional-components/stac-public-access

# CRIM image (https://github.com/crim-ca/stac-browser)
# is a fork of the official stac-browser (https://github.com/radiantearth/stac-browser)
# which is some commits ahead to provide necessary build argument fixes for redirects by the nginx proxy.
# version name is slightly tweaked to fulfill 'service-config' JSON schema while leaving an obvious trace of the source
export STAC_BROWSER_VERSION=3.3.5
export STAC_BROWSER_DOCKER='crim-ca/stac-browser'
export STAC_BROWSER_IMAGE='ghcr.io/${STAC_BROWSER_DOCKER}:${STAC_BROWSER_VERSION}'
export STAC_BROWSER_IMAGE_URI='${STAC_BROWSER_IMAGE}'

# Path prefix parameter against which the docker was built (--build-arg pathPrefix=/stac-browser/ for the above default)
# Because the docker pre-injects the prefix in generated HTML/JS files, they must be aligned with proxy configuration.
# If misconfigured, the browser will attempt to invoke other relative paths to BIRDHOUSE_FQDN_PUBLIC rather than its
# prefixed path 'BIRDHOUSE_FQDN_PUBLIC/stac-browser/...'
# See details:
#   - https://github.com/radiantearth/stac-browser/pull/653
#   - https://github.com/radiantearth/stac-browser/blob/main/docs/docker.md
export STAC_BROWSER_PATH_PREFIX='/stac-browser/'

export DELAYED_EVAL="
  $DELAYED_EVAL
  STAC_BROWSER_IMAGE
  STAC_BROWSER_IMAGE_URI
"

OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$STAC_BROWSER_VERSION
  \$STAC_BROWSER_DOCKER
  \$STAC_BROWSER_IMAGE
  \$STAC_BROWSER_IMAGE_URI<
  \$STAC_BROWSER_PATH_PREFIX
"

# add any component that this component requires to run
COMPONENT_DEPENDENCIES="
  ./components/stac
"
