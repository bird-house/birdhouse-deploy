
x-logging:
  &default-logging
  driver: "json-file"
  options:
    max-size: "50m"
    max-file: "10"

services:
  stac-browser:
    container_name: stac-browser
    image: ${STAC_BROWSER_IMAGE}
    environment:
      # backward compat for older image versions (ghcr.io/crim-ca/stac-browser:docker_image_push)
      - CATALOG_URL=${BIRDHOUSE_PROXY_SCHEME}://${BIRDHOUSE_FQDN_PUBLIC}/stac/
      - ROOT_PATH=/stac-browser/
      # newer image versions (ghcr.io/radiantearth/stac-browser, mininum version 3.1.1)
      # anything in the config (except build params) can be overridden by environment variables with 'SB_' prefix
      # (https://github.com/radiantearth/stac-browser/blob/main/config.js)
      # (https://github.com/radiantearth/stac-browser/blob/main/docs/docker.md)
      - SB_catalogUrl=${BIRDHOUSE_PROXY_SCHEME}://${BIRDHOUSE_FQDN_PUBLIC}/stac/
    logging: *default-logging
    restart: always
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080"]
      interval: 60s
      timeout: 5s
      retries: 3
      start_period: 30s
      start_interval: 5s
