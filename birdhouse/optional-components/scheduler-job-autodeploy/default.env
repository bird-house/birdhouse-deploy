if echo "${BIRDHOUSE_EXTRA_CONF_DIRS}" | grep -q 'jupyterhub[[:space:]]*$'; then
  export BIRDHOUSE_AUTODEPLOY_JUPYTERHUB_ARGS='--volume ${JUPYTERHUB_USER_DATA_DIR}:${JUPYTERHUB_USER_DATA_DIR}:rw
    --env JUPYTERHUB_USER_DATA_DIR=${JUPYTERHUB_USER_DATA_DIR}'
fi

export BIRDHOUSE_AUTODEPLOY_EXTRA_REPOS_AS_DOCKER_VOLUMES='$(for d in ${BIRDHOUSE_AUTODEPLOY_EXTRA_REPOS}; do printf " --volume %s:%s:rw " "$d" "$d"; done)'

# Folder containing ssh deploy keys for all extra git repos
#
# Note when overriding this variable in env.local, do not use HOME environment
# var, use its fully resolved value.  This default value is suitable only for
# backward-compatibility when autodeploy do not run in its own container.
export BIRDHOUSE_AUTODEPLOY_DEPLOY_KEY_ROOT_DIR="$HOME/.ssh"

# Daily at 5:07 AM
export BIRDHOUSE_AUTODEPLOY_PLATFORM_FREQUENCY="7 5 * * *"

export DELAYED_EVAL="
  $DELAYED_EVAL
  BIRDHOUSE_AUTODEPLOY_JUPYTERHUB_ARGS
  BIRDHOUSE_AUTODEPLOY_EXTRA_REPOS_AS_DOCKER_VOLUMES
"

VARS="
  $VARS
  \$BIRDHOUSE_AUTODEPLOY_PLATFORM_FREQUENCY
  \$BIRDHOUSE_AUTODEPLOY_DEPLOY_KEY_ROOT_DIR
"

OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$BIRDHOUSE_AUTODEPLOY_JUPYTERHUB_ARGS
  \$BIRDHOUSE_AUTODEPLOY_CODE_OWNERSHIP
  \$BIRDHOUSE_AUTODEPLOY_EXTRA_REPOS_AS_DOCKER_VOLUMES
  \$AUTODEPLOY_PLATFORM_EXTRA_DOCKER_ARGS
"
