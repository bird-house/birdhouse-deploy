export SCHEDULER_JOB_CLEAN_OLD_FILES_DOCKER=alpine # alpine contains find with -ctime -mtime and -atime options (busybox based containers do not)
export SCHEDULER_JOB_CLEAN_OLD_FILES_VERSION=3.21
export SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE='${SCHEDULER_JOB_CLEAN_OLD_FILES_DOCKER}:${SCHEDULER_JOB_CLEAN_OLD_FILES_VERSION}'

if echo "${BIRDHOUSE_EXTRA_CONF_DIRS}" | grep -qv 'scheduler[[:space:]]*$'; then
  export FINCH_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS=  # unset by default if this job is enabled this must be set to an integer 
  export FINCH_WPS_OUTPUTS_DELETE_FILES_TIME_MODE=atime
  export FINCH_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY="5 4 * * 0" # weekly on Sunday at 4:05
  export FINCH_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED=false
  export __SCHEDULER_JOB_CLEAN_OLD_FILES_FINCH_CONFIG_LOC='$( [ "${FINCH_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED}" = "true" ] && echo "config/finch/config.yml" )'

  export HUMMINGBIRD_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS=  # unset by default if this job is enabled this must be set to an integer 
  export HUMMINGBIRD_WPS_OUTPUTS_DELETE_FILES_TIME_MODE=atime
  export HUMMINGBIRD_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY="10 4 * * 0" # weekly on Sunday at 4:10
  export HUMMINGBIRD_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED=false
  export __SCHEDULER_JOB_CLEAN_OLD_FILES_HUMMINGBIRD_CONFIG_LOC='$( [ "${HUMMINGBIRD_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED}" = "true" ] && echo "config/hummingbird/config.yml" )'

  export RAVEN_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS=  # unset by default if this job is enabled this must be set to an integer 
  export RAVEN_WPS_OUTPUTS_DELETE_FILES_TIME_MODE=atime
  export RAVEN_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY="15 4 * * 0" # weekly on Sunday at 4:15
  export RAVEN_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED=false
  export __SCHEDULER_JOB_CLEAN_OLD_FILES_RAVEN_CONFIG_LOC='$( [ "${RAVEN_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED}" = "true" ] && echo "config/raven/config.yml" )'

  export THREDDS_LOGS_DELETE_FILES_OLDER_THAN_DAYS=  # unset by default if this job is enabled this must be set to an integer 
  export THREDDS_LOGS_DELETE_FILES_TIME_MODE=mtime
  export THREDDS_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY="20 4 * * 0" # weekly on Sunday at 4:20
  export THREDDS_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED=false
  export __SCHEDULER_JOB_CLEAN_OLD_FILES_THREDDS_CONFIG_LOC='$( [ "${THREDDS_SCHEDULER_JOB_CLEAN_OLD_FILES_ENABLED}" = "true" ] && echo "config/thredds/config.yml" )'
fi

export DELAYED_EVAL="
  $DELAYED_EVAL
  SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE
  __SCHEDULER_JOB_CLEAN_OLD_FILES_FINCH_CONFIG_LOC
  __SCHEDULER_JOB_CLEAN_OLD_FILES_HUMMINGBIRD_CONFIG_LOC
  __SCHEDULER_JOB_CLEAN_OLD_FILES_RAVEN_CONFIG_LOC
  __SCHEDULER_JOB_CLEAN_OLD_FILES_THREDDS_CONFIG_LOC
"

OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$FINCH_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS
  \$FINCH_WPS_OUTPUTS_DELETE_FILES_TIME_MODE
  \$FINCH_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY
  \$HUMMINGBIRD_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS
  \$HUMMINGBIRD_WPS_OUTPUTS_DELETE_FILES_TIME_MODE
  \$HUMMINGBIRD_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY
  \$RAVEN_WPS_OUTPUTS_DELETE_FILES_OLDER_THAN_DAYS
  \$RAVEN_WPS_OUTPUTS_DELETE_FILES_TIME_MODE
  \$RAVEN_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY
  \$THREDDS_LOGS_DELETE_FILES_OLDER_THAN_DAYS
  \$THREDDS_LOGS_DELETE_FILES_TIME_MODE
  \$THREDDS_SCHEDULER_JOB_CLEAN_OLD_FILES_FREQUENCY
"

VARS="
  $VARS
  \$SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE
"
