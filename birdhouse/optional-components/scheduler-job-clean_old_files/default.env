export SCHEDULER_JOB_CLEAN_OLD_FILES_DOCKER=alpine # alpine contains find with -mmin -ctime -mtime and -atime options (busybox based containers do not)
export SCHEDULER_JOB_CLEAN_OLD_FILES_VERSION=3.21
export SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE='${SCHEDULER_JOB_CLEAN_OLD_FILES_DOCKER}:${SCHEDULER_JOB_CLEAN_OLD_FILES_VERSION}'

_set_scheduler_job_clean_old_file_defaults() {
  eval "export SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_TIME_MODE=${3:-atime}"
  eval "export SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_FREQUENCY='${2}'"
  eval "export SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_ENABLED=false"
  eval "export __SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_CONFIG_LOC='\$( [ \"\${SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_ENABLED}\" = 'true' ] && echo "config/$(echo $1 | tr '[:upper:]' '[:lower:]')/config.yml" )'"
  export DELAYED_EVAL="
    $DELAYED_EVAL
    __SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_CONFIG_LOC
"
  OPTIONAL_VARS="
  $OPTIONAL_VARS
  \$SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_OLDER_THAN
  \$SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_TIME_MODE
  \$SCHEDULER_JOB_CLEAN_OLD_FILES_${1}_FREQUENCY
"
}

# To add more jobs to clean up files, add a new config.yml file and docker-compose-extra.yml under configs/<component>/ 
# (see existing examples for details).
# Then add another call to the function below where the first argument is the unique component name (in all caps), 
# the second argument is the cron schedule and the optional 3rd argument is the time mode (default is atime).
_set_scheduler_job_clean_old_file_defaults FINCH '5 4 * * 0'
_set_scheduler_job_clean_old_file_defaults HUMMINGBIRD '10 4 * * 0'
_set_scheduler_job_clean_old_file_defaults RAVEN '15 4 * * 0'
_set_scheduler_job_clean_old_file_defaults THREDDS '20 4 * * 0' mtime

export DELAYED_EVAL="
  $DELAYED_EVAL
  SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE
"

VARS="
  $VARS
  \$SCHEDULER_JOB_CLEAN_OLD_FILES_IMAGE
"
