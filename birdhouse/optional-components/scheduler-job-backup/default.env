export SCHEDULER_JOB_BACKUP_DOCKER=docker
export SCHEDULER_JOB_BACKUP_VERSION=28.0.2-cli
export SCHEDULER_JOB_BACKUP_IMAGE='${SCHEDULER_JOB_BACKUP_DOCKER}:${SCHEDULER_JOB_BACKUP_VERSION}'

# image used to copy files from one location to another
export SCHEDULER_JOB_BACKUP_COPY_FILE_IMAGE='${BASH_IMAGE}'
# image used to run curl when backups require a RESTful API step
export SCHEDULER_JOB_BACKUP_CURL_IMAGE='${CURL_IMAGE}'

# volume used to temporarily store all backups locally before they can be moved to their final location
# Note: this must be a named volume (not a bind mount) due to limitations of the scheduler service
export SCHEDULER_JOB_BACKUP_VOLUME=birdhouse-external-backup

# Common arguments used by many backup scheduler jobs (see the config/ directory in this folder for examples)
export SCHEDULER_JOB_BACKUP_COMMON_ARGS='
    --rm
    --volume /var/run/docker.sock:/var/run/docker.sock:ro
    --volume ${COMPOSE_DIR}/..:${COMPOSE_DIR}/..:rw
    --volume ${BIRDHOUSE_LOCAL_ENV}:${BIRDHOUSE_LOCAL_ENV}
    --env BIRDHOUSE_BACKWARD_COMPATIBLE_ALLOWED=${BIRDHOUSE_BACKWARD_COMPATIBLE_ALLOWED}
    --env BIRDHOUSE_LOCAL_ENV=${BIRDHOUSE_LOCAL_ENV}
    --env BIRDHOUSE_COMPOSE=${BIRDHOUSE_COMPOSE}
    --env BIRDHOUSE_LOG_LEVEL=${BIRDHOUSE_LOG_LEVEL}
    --env BIRDHOUSE_LOG_QUIET=${BIRDHOUSE_LOG_QUIET}
'

# All scheduler jobs should run at approximately the same time so that they will all be finished
# before the final step that moves all backed up data to its final location is run.
export SCHEDULER_JOB_BACKUP_FREQUENCY='1 1 * * *' # at 1:01 am daily

# Variable that stores the location of the birdhouse executable which is used in many scheduler jobs.
export SCHEDULER_JOB_BIRDHOUSE_EXE_LOC='${COMPOSE_DIR}/../bin/birdhouse'

DELAYED_EVAL="
  $DELAYED_EVAL
  SCHEDULER_JOB_BACKUP_IMAGE
  SCHEDULER_JOB_BACKUP_COMMON_ARGS
  SCHEDULER_JOB_BIRDHOUSE_EXE_LOC
  SCHEDULER_JOB_BACKUP_COPY_FILE_IMAGE
  SCHEDULER_JOB_BACKUP_CURL_IMAGE
"

VARS="
  $VARS
  \$SCHEDULER_JOB_BACKUP_VOLUME
  \$SCHEDULER_JOB_BACKUP_IMAGE
  \$SCHEDULER_JOB_BACKUP_COMMON_ARGS
  \$SCHEDULER_JOB_BACKUP_FREQUENCY
  \$SCHEDULER_JOB_BIRDHOUSE_EXE_LOC
  \$SCHEDULER_JOB_BACKUP_COPY_FILE_IMAGE
  \$SCHEDULER_JOB_BACKUP_CURL_IMAGE
"